<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      topコマンドでロードアベレージを見る &middot; 渋谷ではたらくインフラエンジニアのブログ
    
  </title>

  <link rel="stylesheet" href="/styles.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="渋谷ではたらくインフラエンジニアのブログ" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">渋谷ではたらくインフラエンジニアのブログ</a>
          <small></small>
        </h3>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">topコマンドでロードアベレージを見る</h1>
  <time datetime="2011-02-15T15:58:48-08:00" class="post-date">15 Feb 2011</time>
  <div class="wp_social_bookmarking_light">
  <div class="wsbl_hatena_button">
    <a href="http://b.hatena.ne.jp/entry/http://b.l0g.jp/dev/top-loadaverag/" class="hatena-bookmark-button" data-hatena-bookmark-title="topコマンドでロードアベレージを見る" data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"> <img src="//b.hatena.ne.jp/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
  </div>
  
  <div class="wsbl_facebook_like">
    <div id="fb-root">
    </div><fb:like href="http://b.l0g.jp/dev/top-loadaverag/" layout="button_count" action="like" width="100" share="false" show_faces="false"></fb:like>
  </div>
  
  <div class="wsbl_twitter">
    &lt;a href="https://twitter.com/share" class="twitter-share-button"{count} data-url="http://b.l0g.jp/dev/top-loadaverag/" data-text="topコマンドでロードアベレージを見る" data-via="dblmkt " data-lang="ja"&gt;Tweet
  </div>
  
  <div class="wsbl_google_plus_one">
    <g:plusone size="medium" annotation="none" href="http://b.l0g.jp/dev/top-loadaverag/"></g:plusone>
  </div>
</div>

<p><br class="wp_social_bookmarking_light_clear" /></p>

<p>Linuxにおいて、システムの全体的な負荷状況を知りたい時、リアルタイムの状況を知るにはtopコマンド、ある程度の期間に渡る傾向をつかむにはsar(sysstat)の結果を確認するのが一般的だろう。</p>

<p>そのサーバ上で動作するアプリケーションの動作が遅いなどといったパフォーマンス劣化がある時、まず最初に見るべきがロードアベレージの値。これは「CPUの処理を待っているタスクの数」であり、ほとんど何も処理を行っていない時には0になる。</p>

<p>topコマンドの表示内容</p>

<p>[text]</p>

<p>top – 16:04:44 up 15 days, 21:40, 2 users, load average: 0.00, 0.00, 0.00</p>

<p>Tasks: 108 total, 2 running, 105 sleeping, 0 stopped, 1 zombie</p>

<p>Cpu(s): 0.0% us, 0.0% sy, 0.0% ni, 100.0% id, 0.0% wa, 0.0% hi, 0.0% si</p>

<p>Mem: 8113608k total, 8082584k used, 31024k free, 69652k buffers</p>

<p>Swap: 8385920k total, 352k used, 8385568k free, 6008888k cached</p>

<p>PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND</p>

<p>1 root 16 0 1848 552 472 S 0.0 0.0 0:01.32 init</p>

<p>2 root RT 0 0 0 0 S 0.0 0.0 0:17.52 migration/0</p>

<p>3 root 34 19 0 0 0 S 0.0 0.0 0:00.40 ksoftirqd/0</p>

<p>4 root RT 0 0 0 0 S 0.0 0.0 0:15.31 migration/1</p>

<p>5 root 34 19 0 0 0 S 0.0 0.0 0:00.32 ksoftirqd/1</p>

<p>6 root RT 0 0 0 0 S 0.0 0.0 0:11.21 migration/2</p>

<p>7 root 34 19 0 0 0 S 0.0 0.0 0:00.17 ksoftirqd/2</p>

<p>8 root RT 0 0 0 0 S 0.0 0.0 0:15.26 migration/3</p>

<p>9 root 34 19 0 0 0 S 0.0 0.0 0:00.25 ksoftirqd/3</p>

<p>10 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 events/0</p>

<p>11 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 events/1</p>

<p>12 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 events/2</p>

<p>13 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 events/3</p>

<p>14 root 7 -10 0 0 0 S 0.0 0.0 0:00.00 khelper</p>

<p>15 root 15 -10 0 0 0 S 0.0 0.0 0:00.00 kacpid</p>

<p>95 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 kblockd/0</p>

<p>96 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 kblockd/1</p>

<p>[/text]</p>

<p>1行目の右端に表示されているのがロードアベレージの値。前述の通りCPUの処理を待っているタスクの数がロードアベレージなので、値が大きければ大きいほどCPUの処理を待っているタスクが多いということになり、それだけサーバのレスポンスが落ちることになる。ただし、単に計算を待っているだけではなく、IOの処理を待っている場合もこの値が大きくなるので、ロードアベレージが大きいことが即CPUが遅いことになるわけではない。CPUそのもの、メモリ、ディスク、それ以外、の何が原因で遅いか調査する必要がある。</p>

<p>なお、topでのロードアベレージの表示は、左から、1分、5分、15分間の平均値になっている。つまり、左の方が値が大きければ、直近の数分間で急に負荷が上がっていることを表す。</p>

<p>言わずもがなだが下半分には、CPUの使用率順に並んだプロセス一覧が表示されるので、ここからCPU負荷が高かったりメモリの使用量が多いアプリケーションが何なのかは大体つかめる。topからなんとなくのあたりをつけたあと、何がボトルネックになっているかを探すには、sarコマンドで過去のパフォーマンスデータを確認していく。</p>

<hr />

<p><strong>海外の役立つブログ記事などを人力で翻訳して公開する<a href="https://yakst.com/ja">Yakst</a>というプロジェクトをやっています。よろしければそちらもどうぞ！</strong></p>

</article>


<aside class="related">
  <h3>Related posts</h3>
  <ul class="related-posts">
    
      <li>
        <a href="/aws/periodic-ebs-snapshot/">
          AWSのEBSボリュームのスナップショットを定期的に取る
          <small><time datetime="2015-10-19T06:33:30-07:00">19 Oct 2015</time></small>
        </a>
      </li>
    
      <li>
        <a href="/misc/my-twitter-bots/">
          Twitterボットを作るのがひそかな趣味
          <small><time datetime="2015-05-22T06:26:26-07:00">22 May 2015</time></small>
        </a>
      </li>
    
      <li>
        <a href="/uncategorized/sql-performance-explained-ja/">
          「SQLパフォーマンス詳解」という本を翻訳しました
          <small><time datetime="2015-04-07T01:45:15-07:00">07 Apr 2015</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2016-04-01T10:52:50-07:00">2016</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
  </body>
</html>
