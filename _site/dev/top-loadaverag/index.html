<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      topコマンドでロードアベレージを見る &middot; 渋谷ではたらくインフラエンジニアのブログ
    
  </title>

  <link rel="stylesheet" href="/styles.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="渋谷ではたらくインフラエンジニアのブログ" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">渋谷ではたらくインフラエンジニアのブログ</a>
          <small></small>
        </h3>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">topコマンドでロードアベレージを見る</h1>
  <time datetime="2011-02-15T15:58:48-08:00" class="post-date">15 Feb 2011</time>
  <p>Linuxにおいて、システムの全体的な負荷状況を知りたい時、リアルタイムの状況を知るにはtopコマンド、ある程度の期間に渡る傾向をつかむにはsar(sysstat)の結果を確認するのが一般的だろう。</p>

<p>そのサーバ上で動作するアプリケーションの動作が遅いなどといったパフォーマンス劣化がある時、まず最初に見るべきがロードアベレージの値。これは「CPUの処理を待っているタスクの数」であり、ほとんど何も処理を行っていない時には0になる。</p>

<p>topコマンドの表示内容</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  
top - 16:04:44 up 15 days, 21:40, 2 users, load average: 0.00, 0.00, 0.00
  
Tasks: 108 total, 2 running, 105 sleeping, 0 stopped, 1 zombie
  
Cpu(s): 0.0% us, 0.0% sy, 0.0% ni, 100.0% id, 0.0% wa, 0.0% hi, 0.0% si
  
Mem: 8113608k total, 8082584k used, 31024k free, 69652k buffers
  
Swap: 8385920k total, 352k used, 8385568k free, 6008888k cached

PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND
  
1 root 16 0 1848 552 472 S 0.0 0.0 0:01.32 init
  
2 root RT 0 0 0 0 S 0.0 0.0 0:17.52 migration/0
  
3 root 34 19 0 0 0 S 0.0 0.0 0:00.40 ksoftirqd/0
  
4 root RT 0 0 0 0 S 0.0 0.0 0:15.31 migration/1
  
5 root 34 19 0 0 0 S 0.0 0.0 0:00.32 ksoftirqd/1
  
6 root RT 0 0 0 0 S 0.0 0.0 0:11.21 migration/2
  
7 root 34 19 0 0 0 S 0.0 0.0 0:00.17 ksoftirqd/2
  
8 root RT 0 0 0 0 S 0.0 0.0 0:15.26 migration/3
  
9 root 34 19 0 0 0 S 0.0 0.0 0:00.25 ksoftirqd/3
  
10 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 events/0
  
11 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 events/1
  
12 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 events/2
  
13 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 events/3
  
14 root 7 -10 0 0 0 S 0.0 0.0 0:00.00 khelper
  
15 root 15 -10 0 0 0 S 0.0 0.0 0:00.00 kacpid
  
95 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 kblockd/0
  
96 root 5 -10 0 0 0 S 0.0 0.0 0:00.00 kblockd/1
  
</code></pre>
</div>

<p>1行目の右端に表示されているのがロードアベレージの値。前述の通りCPUの処理を待っているタスクの数がロードアベレージなので、値が大きければ大きいほどCPUの処理を待っているタスクが多いということになり、それだけサーバのレスポンスが落ちることになる。ただし、単に計算を待っているだけではなく、IOの処理を待っている場合もこの値が大きくなるので、ロードアベレージが大きいことが即CPUが遅いことになるわけではない。CPUそのもの、メモリ、ディスク、それ以外、の何が原因で遅いか調査する必要がある。</p>

<p>なお、topでのロードアベレージの表示は、左から、1分、5分、15分間の平均値になっている。つまり、左の方が値が大きければ、直近の数分間で急に負荷が上がっていることを表す。</p>

<p>言わずもがなだが下半分には、CPUの使用率順に並んだプロセス一覧が表示されるので、ここからCPU負荷が高かったりメモリの使用量が多いアプリケーションが何なのかは大体つかめる。topからなんとなくのあたりをつけたあと、何がボトルネックになっているかを探すには、sarコマンドで過去のパフォーマンスデータを確認していく。</p>

<hr />

<p><strong>海外の役立つブログ記事などを人力で翻訳して公開する<a href="https://yakst.com/ja">Yakst</a>というプロジェクトをやっています。よろしければそちらもどうぞ！</strong></p>

</article>


<aside class="related">
  <h3>Related posts</h3>
  <ul class="related-posts">
    
      <li>
        <a href="/aws/periodic-ebs-snapshot/">
          AWSのEBSボリュームのスナップショットを定期的に取る
          <small><time datetime="2015-10-19T06:33:30-07:00">19 Oct 2015</time></small>
        </a>
      </li>
    
      <li>
        <a href="/misc/my-twitter-bots/">
          Twitterボットを作るのがひそかな趣味
          <small><time datetime="2015-05-22T06:26:26-07:00">22 May 2015</time></small>
        </a>
      </li>
    
      <li>
        <a href="/uncategorized/sql-performance-explained-ja/">
          「SQLパフォーマンス詳解」という本を翻訳しました
          <small><time datetime="2015-04-07T01:45:15-07:00">07 Apr 2015</time></small>
        </a>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2016-04-01T11:57:39-07:00">2016</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
  </body>
</html>
