<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      渋谷ではたらくインフラエンジニアのブログ &middot; 
    
  </title>

  <link rel="stylesheet" href="/styles.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="渋谷ではたらくインフラエンジニアのブログ" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">渋谷ではたらくインフラエンジニアのブログ</a>
          <small></small>
        </h3>
      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/linux/big-mem-allocated-to-jvm-on-centos6/">
        CentOS 6になったらTomcatのJVMが仮想メモリを大量に確保するようになった
      </a>
    </h1>

    <time datetime="2013-11-18T11:47:45-08:00" class="post-date">18 Nov 2013</time>

    <p> </p>

<p>CentOS 5+Tomcat 7+JDK 7+Apacheという組み合わせで動かしていたサーバ群に、OSだけCentOS 6にしてミドルウェアのバージョンは変えないサーバを何台か追加したところ、CentOS 6の方が、Tomcatが確保している仮想メモリ量が圧倒的にでかいことに気づいた。</p>

<p>ちなみに、どちらのサーバもヒープサイズは「-Xmn1024m -Xmx2048m -Xms2048m」となっており、本来なら2GBプラスアルファ(コードキャッシュ他の領域分)しかメモリは食わないはずだ。もちろん、ロードバランサではどちらのサーバにも同じ重みでアクセスを流していおり、負荷は同じのはず。</p>

<p><strong>CentOS 5のサーバ</strong></p>

<p>こちらはざっくり3GB弱の仮想メモリを確保していると出ている(左から5番目、VSZの列)。ヒープサイズから考えるとまあこんなものかというレベル。</p>

<p>[code]</p>

<p># ps auwx</p>

<p>USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</p>

<p>31234 10315 110 8.8 3134280 1447956 ? Sl Nov14 6870:09 /usr/local/java/bin/java -Djava.util.logging.config.file=/usr/l cal/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -server -XX:MaxPermSize=128m -XX:PermSize=128m -XX:SurvivorRatio=2 -Xmn1024m -Xmx2048m -Xms2048m (後略)</p>

<p>[/code]</p>

<p><strong>CentOS 6のサーバ</strong></p>

<p>一方こちらは10GB弱ものメモリを確保していることになっている。ヒープサイズとの差分9GB近くはどっから出てきたのか？</p>

<p>[code]</p>

<p># ps auwx</p>

<p>USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</p>

<p>31234 19463 156 33.6 11270576 2708744 ? Sl Nov14 9532:10 /usr/local/java/bin/java -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -server -XX:MaxPermSize=128m -XX:PermSize=128m -XX:SurvivorRatio=2 -Xmn1024m -Xmx2048m -Xms2048m (後略)</p>

<p>[/code]</p>

<p>CentOS 6の方のサーバのTomcatのプロセスIDを指定してpmapコマンドでメモリの確保状況を見てみると、何やら同じ容量(64MBぐらい)を確保しているanonという行がたくさん表示されているのが目につく。これが悪さしているようだ。ちなみに、一番右の列には通常そのメモリを確保しているファイル名が出るが、anonというのは匿名で割り当てのみがされた領域を示しているようだ。</p>

<p>[code]</p>

<table>
  <tbody>
    <tr>
      <td># pmap -x 19463</td>
      <td>sort -k2 -n</td>
    </tr>
  </tbody>
</table>

<p>Address Kbytes RSS Dirty Mode Mapping</p>

<p>(略)</p>

<p>00007f08d0218000 63392 0 0 —– [ anon ]</p>

<p>00007f0878215000 63404 0 0 —– [ anon ]</p>

<p>00007f099c208000 63456 0 0 —– [ anon ]</p>

<p>00007f08941fe000 63496 0 0 —– [ anon ]</p>

<p>00007f09341fb000 63508 0 0 —– [ anon ]</p>

<p>00007f091c1ea000 63576 0 0 —– [ anon ]</p>

<p>00007f08901e5000 63596 0 0 —– [ anon ]</p>

<p>00007f08fc1e3000 63604 0 0 —– [ anon ]</p>

<p>00007f09c01e0000 63616 0 0 —– [ anon ]</p>

<p>00007f094c1d8000 63648 0 0 —– [ anon ]</p>

<p>(略)</p>

<p>[/code]</p>

<p>調べてみたところ、この現象は、CentOS 6に含まれているglibc 2.11の挙動によるものだそうだ。glibc 2.10から、スレッドごとにメモリ空間を割り当てるような実装に変わったとのこと。なお、CentOS 5ではglibcは2.5。以下、<a title="glibc 2.10 news" href="http://udrepper.livejournal.com/20948.html" target="_blank">glibcのコミッタUlrich Drepper氏による2.10のchangelog解説</a>からの抜粋。</p>

<blockquote>
  <p>glibcに対する今回の変更では、スレッドごとにメモリプールを作るようになった。これで多くの場面で間違った割り当てを排除することができる。メタデータは通常1つのスレッド内でしかアクセスしない(スレッドは割り当てられたコアから移動されないのが望ましい)。アドレス空間を吹き飛ばしてしまうようなメモリのハンドリングを防ぐため、メモリプールの使い過ぎに上限が設けられた。デフォルトでは、32ビットマシンではコアあたりメモリプール2つ、64ビットマシンではコアあたりメモリプール8つを生成する。</p>
</blockquote>

<p>プールが確保するサイズは64MBであり、上の例のCentOS 6のマシンの場合、CPUは24コアの64ビットマシンなので、「24コア x 8 x 64MB」が仮想メモリとして確保されているため、VSSの列の値が大きくなっていたというわけだ。なお、このプール用のメモリはあくまで割り当てられただけで使用されているわけではない。そのため、実際に使われているメモリはRSS(Resident Set Size)の列に表示されているものである(当然だが)。</p>

<p>Tomcat動かしてて気づいたのでタイトルが「TomcatのJVMが～」となっているが、同じようなつくりのメモリを大きく確保するアプリケーションでは同じことになるのは言わずもがな。</p>

<p>参考1 : <a href="http://www.quora.com/Why-do-some-applications-use-significantly-more-virtual-memory-on-RHEL-6-compared-to-RHEL-5" target="_blank">Quoraのやりとり「なぜいくつかのアプリケーションはRHEL5と比べてRHEL6では明らかに大きな仮想メモリを使うのか？」</a></p>

<p>参考2 : <a href="https://www.ibm.com/developerworks/community/blogs/kevgrig/entry/linux_glibc_2_10_rhel_6_malloc_may_show_excessive_virtual_memory_usage?lang=en" target="_blank">IBM developerWorksの記事「Linuxのglibc 2.10以上(RHEL6)のmallocは仮想メモリの使用量を過大に表示するのか」</a></p>

<p>参考3 : <a href="http://stackoverflow.com/questions/561245/virtual-memory-usage-from-java-under-linux-too-much-memory-used" target="_blank">StackOverflowのやりとり「Linux上でのJavaの仮想メモリ使用量が大きすぎる」</a><br />
解説が非常に詳しくてためになる。</p>

<p>参考4 : <a href="http://udrepper.livejournal.com/20948.html" target="_blank">上述glibcコミッタUlrich Drepper氏の記事</a></p>

<hr />

<p><strong>海外の役立つブログ記事などを人力で翻訳して公開する<a href="https://yakst.com/ja">Yakst</a>というプロジェクトをやっています。よろしければそちらもどうぞ！</strong></p>

  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/mysql/mysql-casual-talks-vol-5/">
        MySQL Casual Talks vol.5 メモ
      </a>
    </h1>

    <time datetime="2013-10-26T07:06:50-07:00" class="post-date">26 Oct 2013</time>

    <p> </p>

<p><a href="http://www.zusaar.com/event/1086003">MySQL Casual Talks vol. 5</a>に行ってきたので、自分なりのメモと資料へのリンク。</p>

<p>途中、アラートが鳴り始めて確認してたりしてメモが適当なところがあるが仕方なしｗ</p>

<p>かなりのスピードでじゃんじゃんプレゼンが進んで行ったが、どれも面白い・役立つ内容ばかりで、楽しいひと時でした。発表者の皆様、会場の提供や調整などしてくださった<a href="https://twitter.com/myfinder" target="_blank">@myfinder</a>さんはじめとする皆様、ありがとうございました。自分の隣でビール缶を次々と「カシュッ」と空けていた<a href="https://twitter.com/oranie" target="_blank">@oranie</a>さんのような余裕を持ちつつ、次回は自分も何かネタを提供できるといいなあ。</p>

<h2 id="a-hrefhttpstwittercomyuryu-targetblankyuryua-gtid"><a href="https://twitter.com/yuryu" target="_blank">@yuryu</a>さん GTIDを使い始めてやめた話</h2>

<div style="margin-bottom: 5px;">
  <strong> <a title="MySQL5.6でGTIDを試してそっと閉じた" href="https://www.slideshare.net/Yuryu/mysql56gtid" target="_blank">MySQL5.6でGTIDを試してそっと閉じた</a> </strong> from <strong><a href="http://www.slideshare.net/Yuryu" target="_blank">Haruka Iwao</a></strong>
</div>

<ul>
  <li>GTID – 全てのトランザクションを一意に識別、一貫性保証</li>
  <li>マスタを切り替えると、マスタのUUIDが変わるのでGTIDが2個になる</li>
  <li>利点
    <ul>
      <li>change master to … master_auto_position=1で簡単にレプリをはれる</li>
      <li>mysql workbenchのmysqlfailoverとか使える</li>
    </ul>
  </li>
  <li>欠点
    <ul>
      <li>クラスタ全部GTID有効にする必要</li>
      <li>MyISAM使用不可</li>
      <li>HAしたいならMHAでいいんじゃね？</li>
    </ul>
  </li>
  <li>バグ
    <ul>
      <li>GTID有効でFLUSH LOGSするとレプリ停止(5.6.11のみ)</li>
      <li>stop/start slaveするとトランザクションがスキップされる可能性あり</li>
      <li>ネットワーク切断でトランザクションスキップの可能性</li>
    </ul>
  </li>
  <li>結局、本格的に使うには時期尚早なので辞めました、ということ</li>
</ul>

<h2 id="a-hrefhttpstwittercomconmame-targetblankconmamea-mysql-56"><a href="https://twitter.com/con_mame" target="_blank">@con_mame</a>さん MySQL 5.6移行記</h2>

<div style="margin-bottom: 5px;">
  <strong> <a title="僕らのMySQL5.6移行記(仮)" href="https://www.slideshare.net/conmame/mysql56-27565355" target="_blank">僕らのMySQL5.6移行記(仮)</a> </strong> from <strong><a href="http://www.slideshare.net/conmame" target="_blank">Yutaka Hoshino</a></strong>
</div>

<ul>
  <li>クックパッでは5.5のサーバを5.6にバージョンアップしたり最初から使ったり</li>
  <li>レプリしてクエリ流してコンフィグいじり始めた
    <ul>
      <li>うまく行ったのは最初だけで問題勃発</li>
    </ul>
  </li>
  <li>EBSでスナップショット取ったボリュームを5.6マシンにぶら下げてmysql_upgrade実行</li>
  <li><a href="https://github.com/cookpad/kage" target="_blank">Kage</a>
    <ul>
      <li>リクエストをコピーしてsandbox環境に流す仕組み(ユーザへはproductionからの結果が返る)</li>
      <li>レスポンスのdiffも取れる</li>
      <li>バックエンドを5.6にして違いを確認</li>
    </ul>
  </li>
  <li>バージョン違い、設定違いのサーバを並べて比較</li>
  <li>開発用DBを先に新しくしてリリース前に新環境を試す</li>
  <li>バグ確認用(最新) → 検証用(1つ前) → 本番用(安定版)</li>
  <li>各バージョンが入ったAMIを用意しておいてすぐ起動できるようにしてある</li>
  <li>GTID有効だとsql_slave_skip_counter使えない</li>
  <li>AWSだと色んな検証がCasualにできる</li>
  <li><a href="http://bugs.mysql.com/" target="_blank">bugs</a>は見ましょう！</li>
  <li>5.6で遅くなるところもあるので、得意な部分から本番投入していっている</li>
</ul>

<h2 id="a-hrefhttpstwittercomyoshiken-targetblankyoshikena-50-tritonn56-mroonga"><a href="https://twitter.com/yoshi_ken" target="_blank">@yoshi_ken</a>さん 5.0 Tritonnから5.6 mroongaへの移行</h2>

<div style="margin-bottom:5px">
  <strong> <a href="https://www.slideshare.net/y-ken/mysql-migrate-mysql50-to-mysql56-with-fulltext" title="Tritonn (MySQL5.0.87+Senna)からの mroonga (MySQL5.6) 移行体験記" target="_blank">Tritonn (MySQL5.0.87+Senna)からの mroonga (MySQL5.6) 移行体験記</a> </strong> from <strong><a href="http://www.slideshare.net/y-ken" target="_blank">Kentaro Yoshida</a></strong>
</div>

<ul>
  <li><a href="http://gihyo.jp/dev/clip/01/groonga/0006">技評の記事</a>の裏話</li>
  <li>旧構成 マスタはDRBDでミラー、スレーブにレプリ</li>
  <li>5.6スレーブを追加してそこに孫をぶら下げて旧環境を切り離し</li>
  <li>本番環境のアクセスログから抜き出したURLを使ってテスト
    <ul>
      <li>5.6で遅くなったクエリをチューニング</li>
      <li><a href="http://d.hatena.ne.jp/oranie/20130402/1364906656" target="_blank">SQLMODE厳格化</a>への対応</li>
    </ul>
  </li>
  <li>テスト中に見つけたmroongaのバグはすぐに修正してもらえた</li>
  <li>HWトラブル
    <ul>
      <li>マスタ死亡、起動しない、焦げ臭い！さらにもう一台も焦げた。。</li>
    </ul>
  </li>
  <li>GTIDよりsemi sync repl + MHAがいいのでわ</li>
  <li>innodb_file_per_tableでなかったのでダンプしてバージョンアップした</li>
  <li>memcached APIはバグで使えなかった</li>
</ul>

<h2 id="a-hrefhttpstwittercomyoku0825-targetblankyoku0825a-ddl"><a href="https://twitter.com/yoku0825" target="_blank">@yoku0825</a>さん アプリ担当が出してきたDDLがドイヒーな話</h2>

<div style="margin-bottom:5px">
  <strong> <a href="https://www.slideshare.net/yoku0825/ss-27597161" title="とあるイルカのバーボンハウス" target="_blank">とあるイルカのバーボンハウス</a> </strong> from <strong><a href="http://www.slideshare.net/yoku0825" target="_blank">yoku0825</a></strong>
</div>

<ul>
  <li>すごい心が痛い&amp;共感出来る内容だったけどテンポ早すぎてメモできなかったｗ</li>
  <li>MariaDB 10からもGTIDが使えるようになった(ただしMySQLとは結構違う)</li>
  <li>ログ用テーブル
    <ul>
      <li>突っ込みどころたくさんww</li>
    </ul>
  </li>
  <li>インデックス名はidx_カラム名_カラム名_…とすると長いけどexplainのときに分かりやすい</li>
  <li>フレームワークが作る通りではなくDBの特性を考える</li>
  <li>SQL文を見るだけでどのインデックスを使うかなどの意図が分かる名前付け</li>
</ul>

<h2 id="a-hrefhttpstwittercomkamipo-targetblankkamipoa-mysql-build"><a href="https://twitter.com/kamipo" target="_blank">@kamipo</a>さん mysql-build</h2>

<p><a href="http://kamipo.github.io/talks/20131025-mysqlcasual5/" target="_blank">プレゼン資料</a></p>

<ul>
  <li>この辺りトラブル発生してメモがおろそか</li>
  <li>いろんなMySQLをインストールして使い分ける仕組み</li>
  <li>percona serverのmysqldumpにはkeyを消してダンプして作り直すオプションがある
    <ul>
      <li>ダンプが高速化</li>
    </ul>
  </li>
  <li>fbの5.6にはlogical key readのオプションがある</li>
</ul>

<h2 id="a-hrefhttpstwittercomdoaki-targetblankdoakia-multi-master-replication"><a href="https://twitter.com/do_aki" target="_blank">@do_aki</a>さん multi master replication</h2>

<div style="margin-bottom: 5px;">
  <strong> <a title="殿堂入りのアレ～Multi-Source Replication を添えて～" href="https://www.slideshare.net/do_aki/ss-27565738" target="_blank">殿堂入りのアレ～Multi-Source Replication を添えて～</a> </strong> from <strong><a href="http://www.slideshare.net/do_aki" target="_blank">do_aki</a></strong>
</div>

<ul>
  <li>MySQL Casual定番の内容</li>
  <li>change masterを2秒ごとに切り替えてマルチマスタ</li>
  <li>5.7では標準でできるようになった</li>
  <li>過去に色々な方法でマルチマスタを試みている人がいるww</li>
</ul>

<h2 id="a-hrefhttpstwittercomrkajiyama-targetblankrkajiyamaa-57-multi-source-replication"><a href="https://twitter.com/RKajiyama" target="_blank">@RKajiyama</a>さん 5.7 Multi-source replication</h2>

<div style="margin-bottom:5px">
  <strong> <a href="https://www.slideshare.net/rkajiyama/20131025-casual-uppt" title="MySQL Casual Talks vol.5 - MySQL Labs - @RKajiyama" target="_blank">MySQL Casual Talks vol.5 &#8211; MySQL Labs &#8211; @RKajiyama</a> </strong> from <strong><a href="http://www.slideshare.net/rkajiyama" target="_blank">rkajiyama</a></strong>
</div>

<ul>
  <li>labsにはDMR以前のものがありますよ
    <ul>
      <li>hadoop applier for mysql
        <ul>
          <li>hadoopをMySQLスレーブのように使う</li>
        </ul>
      </li>
      <li>JSON UDF</li>
      <li>Multi source replication</li>
      <li>MySQL Utilities Fabric
        <ul>
          <li>シャーディングの情報を管理する仕組み</li>
        </ul>
      </li>
      <li>Fabric + multi source replication + multi thread slaveの組み合わせ良さげ</li>
    </ul>
  </li>
</ul>

<h2 id="a-hrefhttpstwittercomsongmu-targetblanksongmua"><a href="https://twitter.com/songmu" target="_blank">@songmu</a>さん</h2>

<p><a href="http://songmu.github.io/slides/mysql-casual-5/" target="_blank">プレゼン資料</a></p>

<ul>
  <li>GitDDL::Migrator, SQLTranslator(SQLFairy)
    <ul>
      <li>ブランチごとにテーブルやカラムが違うと大変</li>
      <li>テーブル構成の違いなどが表示できる</li>
      <li>ブランチを行ったり来たりしながらalterしたりできる</li>
    </ul>
  </li>
  <li>App::RunCron
    <ul>
      <li>perlのラッパー、レポータを書くと色々できる</li>
      <li>cronのログってnullに捨てちゃうけど困るよね</li>
      <li>cronlog</li>
      <li>cronの処理をラップしてエラー処理が可能</li>
    </ul>
  </li>
</ul>

<h2 id="a-hrefhttpstwittercomnekogeruge987-targetblanknekogeruge987a-db2mysql55"><a href="https://twitter.com/nekogeruge_987" target="_blank">@nekogeruge_987</a>さん DB2からMySQL5.5への移行</h2>

<ul>
  <li>13年運用されてるデータベース</li>
  <li>レコードをCSVにしてload infile</li>
  <li>シェルスクリプトで自動化</li>
  <li>4時間以内に終わらせるという時間制約
    <ul>
      <li>loadを高速化する工夫</li>
      <li>ジョブフローの最適化(jenkins build flow plugin)</li>
      <li>ジョブフローをGroovyで書ける(並列実行などなども可)</li>
      <li>データ移行自体をCIする(1クリックデータ移行！)</li>
      <li>/var/lib/mysql以下の並列rsync</li>
    </ul>
  </li>
</ul>

<h2 id="a-hrefhttpstwittercommonry-targetblankmonrya-amazon-rds"><a href="https://twitter.com/monry" target="_blank">@monry</a>さん Amazon RDS</h2>

<div style="margin-bottom: 5px;">
  <strong> <a title="20131025 my sql casual talks vol.5" href="https://www.slideshare.net/monry84/20131025-my-sql-casual-talks-vol5" target="_blank">20131025 my sql casual talks vol.5</a> </strong> from <strong><a href="http://www.slideshare.net/monry84" target="_blank">Tetsuya Mori</a></strong>
</div>

<ul>
  <li>マスタ1台、スレーブ5台
    <ul>
      <li>243ドル/月</li>
    </ul>
  </li>
  <li>物理サーバが1台13万以上ならRDSの方が安い(3年償却)</li>
</ul>

<h2 id="a-hrefhttpstwittercomchobie-targetblankchobiea-"><a href="https://twitter.com/chobi_e" target="_blank">@chobi_e</a>さん ストレージエンジンを作ってみた</h2>

<ul>
  <li><a href="https://twitter.com/kazuho" target="_blank">kazuho</a>さんの<a href="http://d.hatena.ne.jp/kazuhooku/20131001/1380595265" target="_blank">リアルタイムランキング用MySQLストレージエンジンの話</a>
    <ul>
      <li>本を読む</li>
      <li>
        <p><a href="http://www.amazon.co.jp/gp/product/B00ACC6ANM/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=B00ACC6ANM&amp;linkCode=as2&amp;tag=l0gjp-22" rel="nofollow">Expert MySQL</a><img style="border: none !important; margin: 0px !important;" alt="" src="http://ir-jp.amazon-adsystem.com/e/ir?t=l0gjp-22&amp;l=as2&amp;o=9&amp;a=B00ACC6ANM" width="1" height="1" border="0" /></p>

        <p>のChapter 10</p>
      </li>
      <li><a href="http://www.amazon.co.jp/gp/product/1849510601/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=1849510601&amp;linkCode=as2&amp;tag=doublemarket-22" rel="nofollow">Mysql 5.1 Plugin Development</a><img style="border: none !important; margin: 0px !important;" alt="" src="http://ir-jp.amazon-adsystem.com/e/ir?t=doublemarket-22&amp;l=as2&amp;o=9&amp;a=1849510601" width="1" height="1" border="0" /></li>
      <li>ランキングと言えばredis
        <ul>
          <li>sorted setのソースを取ってくる</li>
        </ul>
      </li>
      <li>意外と簡単に書けるので書いてみよう</li>
    </ul>
  </li>
</ul>

<hr />

<p><strong>海外の役立つブログ記事などを人力で翻訳して公開する<a href="https://yakst.com/ja">Yakst</a>というプロジェクトをやっています。よろしければそちらもどうぞ！</strong></p>

  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/mysql/myna-201309-memo/">
        MyNA会2013年9月 メモ
      </a>
    </h1>

    <time datetime="2013-10-01T02:25:00-07:00" class="post-date">01 Oct 2013</time>

    <p> </p>

<p><strong><a href="http://atnd.org/events/43746" target="_blank">MyNA(日本MySQLユーザ会)会 2013年9月</a></strong></p>

<p>先週のMySQL Cluster Casual Talksに続いて、週末にかけて行われた<a href="http://www.oracle.com/mysqlconnect/index.html" target="_blank">MySQL Connect</a>で発表された最新情報を聞けるということで、MyNA会に参加してきた。基調講演の内容は既に報道されていたので(Publickey <a href="http://www.publickey1.jp/blog/13/facebookmysqlmysql_connect_2013.html" target="_blank">(1)</a>, <a href="http://www.publickey1.jp/blog/13/facebooktwitterpaypallinkedinmysqlmysqlmysql_connect_2013.html" target="_blank">(2)</a>, <a href="http://www.publickey1.jp/blog/13/mysql_572mysqlmysql_connect_2013.html" target="_blank">(3)</a>)ある程度分かっていたが、一番うれしかったのはMySQL Fabricのデモが見られたこと。MySQL Utilitiesの機能でシャーディングができるようになるということでどんな感じか見てみたかったので、(ラボ版で一部動かないところがまだあるということだったが)興味深かった。発表者のみなさま、会場を提供していただいたOracleのみなさまなど関係者の方々ありがとうございました。</p>

<h2 id="a-hrefhttpstwittercomrkajiyama-targetblankrkajiyamaa-mysql-connect"><a href="https://twitter.com/RKajiyama" target="_blank">@RKajiyama</a>さん MySQL Connect基調講演の概要</h2>

<ul>
  <li>いつOracleはMySQLを殺すのかと言われてきた → うわさを打ち消すために3年半の間大量のリリースをしてきた</li>
  <li>チーム全体も増員、特に品質管理チーム</li>
  <li>DMR(Development Milestone Release)というやり方
    <ul>
      <li>リリース候補版になったコンポーネントを含んだリリース</li>
      <li>18から24ヶ月ごとにメジャーリリースしたい</li>
    </ul>
  </li>
  <li><strong>Webや組み込み系に強いDBとしてOracleにとっても価値</strong>がある
    <ul>
      <li>現在もLinux系の最も重要なスキル＝MySQL</li>
      <li>今もユーザは多数</li>
    </ul>
  </li>
  <li>5.7.2 DMRの発表
    <ul>
      <li>Release noteが超長かった＝たくさんの更新が含まれている</li>
      <li><strong><a href="https://blogs.oracle.com/mysqlinnodb/entry/innodb_5_7_performance_improvements" target="_blank">InnoDBパフォーマンス向上</a></strong></li>
      <li>explain for connectionで別セッションのexplain</li>
      <li>Optimzerの結果をWorkbenchでさらに詳しく</li>
      <li>performance schema改善
        <ul>
          <li>メモリの使用状況</li>
          <li>storedの詳細</li>
        </ul>
      </li>
      <li>tmpテーブルがInnoに</li>
      <li><strong>同じDB内でのマルチスレッドレプリケーション</strong></li>
    </ul>
  </li>
  <li>5.7の以後のバージョンでの予定
    <ul>
      <li><strong>マルチソースレプリケーション</strong></li>
    </ul>
  </li>
  <li>MySQL Utilities 1.3
    <ul>
      <li><strong>レプリケーションのフェイルオーバをデーモンで</strong></li>
    </ul>
  </li>
  <li>MySQL Utilities 1.4から
    <ul>
      <li><strong><a href="http://www.slideshare.net/nixnutz/mysql-57-fabric-high-availability-and-sharding" target="_blank">Fabric</a></strong>
        <ul>
          <li>アプリから意識せずにシャーディングできる</li>
          <li>Connectorが接続を受けて振り分ける</li>
          <li>レンジかハッシュ、リシャーディング</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="gree-scsk-mysql-connect">いちいさん@Gree, いけださん@SCSK MySQL Connectの感想</h2>

<ul>
  <li>Oracle OpenWorld、JavaOneと一緒にやってる</li>
  <li>SFのホテルいくつも貸し切り、道路も閉鎖して休憩スペースに</li>
  <li><a href="http://medianetwork.oracle.com/video/player/2686429205001" target="_blank">FacebookのMySQLの話</a></li>
  <li>まつのぶさん MySQL 5.6@Facebook
    <ul>
      <li>5.1にパッチ当てたのを使っている
        <ul>
          <li>圧縮、クラッシュセーフスレーブ、フラッシングの高速化など</li>
        </ul>
      </li>
      <li>シャドウサーバ</li>
      <li>5.5を飛ばして5.6へ
        <ul>
          <li>低リスクのところから徐々に移行</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong><a href="http://www.theregister.co.uk/2013/09/12/google_mariadb_mysql_migration/" target="_blank">GoogleがMySQLをやめてMariaDBに全面移行する</a>というのは、XLDBというカンファレンスでの話を元にした記者の煽り記事</strong>で、Googleの人曰く迷惑しているそうだ</li>
</ul>

<h2 id="a-hrefhttpstwittercomyyamasaki1-targetblankyyamasaki1a-json-udfs"><a href="https://twitter.com/yyamasaki1" target="_blank">@yyamasaki1</a>さん JSON UDFs</h2>

<div style="margin-bottom:5px">
  <strong> <a href="https://www.slideshare.net/yoyamasaki/my-sql-jsonudf" title="ドキュメントデータベースとして MySQLを使う!? ～MySQL JSON UDF～" target="_blank">ドキュメントデータベースとして MySQLを使う!? ～MySQL JSON UDF～</a> </strong> from <strong><a href="http://www.slideshare.net/yoyamasaki" target="_blank">yoyamasaki</a></strong>
</div>

<ul>
  <li>MySQL json UDFs
    <ul>
      <li><a href="http://labs.mysql.com/" target="_blank">ラボ版の5.7</a>に搭載された新機能</li>
    </ul>
  </li>
  <li>カラムにJSONをつっこんだものをファンクションで処理できる</li>
</ul>

<h2 id="a-hrefhttpstwittercomrkajiyama-targetblankrkajiyamaa-mysql-fabric"><a href="https://twitter.com/RKajiyama" target="_blank">@RKajiyama</a>さん MySQL Fabric</h2>

<ul>
  <li><a href="http://labs.mysql.com/" target="_blank">ラボ版のMySQL Utilities</a>に搭載された新機能</li>
  <li>マスタにスレーブがぶら下がってる構成
    <ul>
      <li>これを1つのシャード(グループ)として扱う</li>
    </ul>
  </li>
  <li>アプリからConnectorを使ってアクセスする
    <ul>
      <li><strong>ConnectorはFabricに問い合わせ先を確認してからシャードにアクセス</strong></li>
      <li>state storeに情報保存</li>
      <li>スキーマの情報などだけもってデータは持たない</li>
    </ul>
  </li>
  <li>グローバルグループ
    <ul>
      <li>全体に影響のある処理に関係するメタ情報を持つ</li>
    </ul>
  </li>
  <li><strong>アクセス時にRWかROを指定すると、Fabricが自動でマスタあるいはスレーブにアクセスを振る</strong></li>
  <li><strong>lab版は罠だらけ</strong>なので気をつけよう。。</li>
  <li><a href="http://vnwrites.blogspot.jp/" target="_blank">開発者の方のブログ</a>が役に立つ</li>
</ul>

<h2 id="a-hrefhttpstwittercommktredwell-targetblanka-gnu-30mysql"><a href="https://twitter.com/mktredwell" target="_blank">赤井さん</a> GNU 30周年とMySQL</h2>

<ul>
  <li>GNUプロジェクトが始まって30年</li>
  <li>MySQLの成長はGNUの恩恵を受けた</li>
  <li><strong>GNUへのリスペクトを忘れないように</strong>しよう</li>
</ul>

<p> </p>

<hr />

<p><strong>海外の役立つブログ記事などを人力で翻訳して公開する<a href="https://yakst.com/ja">Yakst</a>というプロジェクトをやっています。よろしければそちらもどうぞ！</strong></p>

  </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page4">Older</a>
  
  
    <a class="pagination-item newer" href="/page2">Newer</a>
  
</div>

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2016-04-01T11:15:44-07:00">2016</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
  </body>
</html>
